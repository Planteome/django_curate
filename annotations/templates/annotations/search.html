{% extends 'base.html' %}

{% load humanize %}

{% block main %}
    Found {{ count|intcomma }} results.{% if count == 10000 %} Results are limited to 10,000 results for performance.{% endif %}
    <table class="table table-striped table-bordered table-hover">
    <thead>
        <th><h4>Annotation (internal ID)</h4></th>
        <th><h4>Gene</h4></th>
        <th><h4>Ontology ID:</h4></th>
        <th><h4>Species</h4></th>
    </thead>
    {% for annotation in all_search_results %}
        <tr>
        <td><a href="{% url 'annotations:annotation' pk=annotation.pk %}">{{ annotation.pk }}</a> </td>
        <td>
            {% if annotation.internal_gene %}
                <a href="{% url 'genes:gene' pk=annotation.internal_gene.id %}">{{ annotation.db_obj_symbol }}</a>
            {% else %}
                {{ annotation.db_obj_synonym }}
            {% endif %}
        </td>
        <td>
            <a href="https://browser.planteome.org/amigo/term/{{ annotation.ontology_id }}">{{ annotation.ontology_id }}</a>
                &nbsp;-&nbsp;
                <div style="display: inline-block" id="{{ annotation.pk }}_ont_term"></div>
                <script type="application/javascript">
                    $.getJSON("https://browser.planteome.org/api/entity/terms?entity={{ annotation.ontology_id }}", function(json){
                        const element = document.getElementById("{{ annotation.pk }}_ont_term");
                        element.innerHTML = json.data[0].annotation_class_label;
                    });
                </script>
        </td>
        <td>
            <a href="{% url 'taxon:taxon' ncbiID=annotation.taxon_id %}">{{ annotation.taxon }}</a>
        </td>
        </tr>
    {% empty %}
        <h2>No results found</h2>
    {% endfor %}
    </table>
    {% if is_paginated %}
        {% block pagination %}
            {% include 'pagination.html' %}
        {% endblock %}
    {% endif %}
{% endblock main %}